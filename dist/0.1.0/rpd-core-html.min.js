/* RPD v0.1.0
 https://shamansir.github.io/rpd
 LICENSE: MIT (c) 2015 Anton Kotenko <shaman.sir@gmail.com> */

var Rpd=function(){function d(a){this.name=a;this.targets=Kefir.emitter();this.renderers=Kefir.emitter();a={"model/new":function(a){return{model:a}},"node/add":function(a){return{node:a}},"node/remove":function(a){return{node:a}}};this.event=I(a);this.events=L(a,this.event);Kefir.combine([this.events,this.targets.scan(J),this.renderers.scan(J)]).onValue(function(a){var b=a[0],e=a[2];M(a[1],function(a){M(e,function(E){E(a,b)})})});this.event["model/new"].emit(this)}function t(a,b){this.type=a||"core/empty";
this.id=K();var g=G(x[this.type]);g||H("Node type "+this.type+" is not registered!");this.def=g;this.name=b||g.name||"Unnamed";this.def=g;this.render=O(g.render);var e=this,g={"node/turn-on":function(a){return{node:e}},"node/ready":function(a){return{node:e}},"node/process":function(a){return{inlets:a[0],outlets:a[1],node:e}},"node/turn-off":function(a){return{node:e}},"inlet/add":function(a){return{inlet:a}},"inlet/remove":function(a){return{inlet:a}},"outlet/add":function(a){return{outlet:a}},"outlet/remove":function(a){return{outlet:a}}};
this.event=I(g);this.events=L(g,this.event);p[z]?p[z].addNode(this):H("No model started!");if(this.def.handle)this.events.onValue(function(a){if(e.def.handle[a.type])e.def.handle[a.type](a)});if(this.def.process){var h=this.def.process,e=this;Kefir.combine([this.event["inlet/add"].flatMap(function(a){var b=a.event["inlet/update"].map(function(b){return{inlet:a,alias:a.alias,value:b}});e.def.tune&&(b=e.def.tune(b));return b}).scan(function(a,b){var E=b.alias,e=b.inlet,g,c;if(a)return g=a.prev,c=a.cur,
g[E]=c[E],c[E]=b.value,a.source=e,a;g={};c={};c[E]=b.value;return{prev:g,cur:c,source:e}},null).filter(function(a){return!(a&&a.source.cold)}),this.event["outlet/add"].scan(function(a,b){a=a||{};a[b.alias]=b;return a},null)]).onValue(function(a){var b=a[0]||{prev:{},cur:{}};a=a[1]||{};var E=h(b.cur,b.prev);e.event["node/process"].emit([b.cur,E,b.prev]);for(var c in E)a[c]&&a[c].send(E[c])})}if(this.def.inlets){this.inlets={};for(var c in this.def.inlets)g=this.def.inlets[c],g=this.addInlet(g.type,
c,g.name,g.default,g.hidden,g.readonly,g.cold),this.inlets[c]=g}if(this.def.outlets)for(c in this.outlets={},this.def.outlets)g=this.def.outlets[c],g=this.addOutlet(g.type,c,g.name,g.default),this.outlets[c]=g;this.def.prepare&&this.def.prepare(this.inlets,this.outlets);this.event["node/ready"].emit(this)}function b(a,b,e,c,f,d,y,m){this.type=a||"core/bool";this.id=K();var n=G(h[this.type]);n||H("Inlet type "+this.type+" is not registered!");this.def=n;(this.alias=e||c||n.alias)||H("Inlet should have either alias or name");
this.name=c||this.alias||n.name||"Unnamed";this.node=b;this.hidden=d||!1;this.readonly=P(y||n.readonly)?y||n.readonly:!0;this.cold=m||!1;this.default=P(f)?f:n.default;this.value=Kefir.bus();this.render=O(n.render);var r=this;a={"inlet/update":function(a){return{inlet:r,value:a}}};this.event=I(a);var k=this.event["inlet/update"];b=k.merge(this.value);n.tune&&(b=n.tune(b));n.accept&&(b=b.flatten(function(a){if(n.accept(a))return[a];k.error();return[]}));n.adapt&&(b=b.map(n.adapt));this.event["inlet/update"]=
b.onValue(function(){});this.events=L(a,this.event)}function m(a,b,e,c,f){this.type=a||"core/bool";this.id=K();(a=G(h[this.type]))||H("Outlet type "+this.type+" is not registered!");this.def=a;(this.alias=e||c||a.alias)||H("Outlet should have either alias or name");this.name=c||this.alias||a.name||"Unnamed";this.node=b;this.default=P(f)?f:a.default;this.value=Kefir.bus();this.render=O(a.render);var d=this;b={"outlet/update":function(a){return{outlet:d,value:a}},"outlet/connect":function(a){return{outlet:d,
link:a}},"outlet/disconnect":function(a){return{outlet:d,link:a}}};this.event=I(b);this.event["outlet/update"]=this.event["outlet/update"].merge(this.value).onValue(function(){});this.events=L(b,this.event);Kefir.sampledBy([this.event["outlet/update"]],[this.event["outlet/connect"]]).onValue(function(a){d.value.emit(a[0])})}function u(a,b,c,h,f){this.type=a||"core/pass";this.id=K();(a=G(e[this.type]))||H("Link type "+this.type+" is not registered!");this.def=a;this.name=f||a.name||"";this.outlet=
b;this.inlet=c;this.adapter=h||a.adapt||void 0;var d=this;this.receiver=b.node.id!==c.node.id?function(a){return function(b){a.pass(b)}}(d):function(a){setTimeout(function(){d.pass(a)},0)};b={"link/enable":function(){return{link:d}},"link/disable":function(){return{link:d}},"link/pass":function(a){return{link:d,value:a}},"link/adapt":function(a){return{link:d,before:a[0],after:a[1]}}};this.event=I(b);this.events=L(b,this.event);this.enabled=Kefir.merge([this.event["link/disable"].mapTo(!1),this.event["link/enable"].mapTo(!0)]).toProperty(!0);
this.event["link/pass"].filterBy(this.enabled).onValue(function(a){c.receive(d.adapt(a))});Kefir.sampledBy([this.event["link/pass"]],[this.event["link/enable"]]).onValue(function(a){d.pass(a[0])})}function P(a){return"undefined"!==typeof a}function G(a){return a?"function"===typeof a?a():a:null}function O(a){if(!a)return{};var b={},c;for(c in a)b[c]=G(a[c]);return b}function I(a){var b={},c;for(c in a)b[c]=Kefir.emitter();return b}function L(a,b){var c=Kefir.pool(),e;for(e in a)(function(a,e){c.plug(b[a].map(function(b){b=
e(b);b.type=a;return b}))})(e,a[e]);return c}function H(a,b){b=b||Error(a);console&&(console.error?console.error(b):console.log(b));throw b;}function K(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function J(a,b){return[b,Array.isArray(a)?a:[a,null]]}function M(a,b){a&&(Array.isArray(a)?(b(a[0]),M(a[1],b)):b(a))}function Q(a,b,c){for(var e=[],h=0,d=b.length;h<d;h++)e.push(b[h](c));return function(b,c){a(b,c);for(var h=0,d=e.length;h<d;h++)e[h](b,c)}}var x={},e={},h={},
f={},c={},k={},z=-1,p=[];d.prototype.attachTo=function(a){this.targets.emit(a);return this};d.prototype.addNode=function(a){this.events.plug(a.events);this.event["node/add"].emit(a);a.turnOn();return this};d.prototype.removeNode=function(a){a.turnOff();this.event["node/remove"].emit(a);this.events.unplug(a.events);return this};d.prototype.renderWith=function(a,b){if(!c[a])throw Error("Renderer "+a+" is not registered");var e=c[a](b);k[a]&&k[a].length?this.renderers.emit(Q(e,k[a]),b):this.renderers.emit(e);
return this};d.start=function(a){a=new d(a);p.push(a);z++;return a};t.prototype.turnOn=function(){this.event["node/turn-on"].emit(this)};t.prototype.turnOff=function(){this.event["node/turn-off"].emit(this)};t.prototype.addInlet=function(a,c,e,h,d,f,m){a=new b(a,this,c,e,h,d,f,m);this.events.plug(a.events);this.event["inlet/add"].emit(a);a.toDefault();return a};t.prototype.addOutlet=function(a,b,c,e){a=new m(a,this,b,c,e);this.events.plug(a.events);this.event["outlet/add"].emit(a);return a};t.prototype.removeInlet=
function(a){this.event["inlet/remove"].emit(a);this.events.unplug(a.events)};t.prototype.removeOutlet=function(a){this.event["outlet/remove"].emit(a);this.events.unplug(a.events)};b.prototype.receive=function(a){this.value.emit(a)};b.prototype.stream=function(a){this.value.plug(a)};b.prototype.toDefault=function(){P(this.default)&&this.default instanceof Kefir.Stream?this.stream(this.default):this.receive(this.default)};m.prototype.connect=function(a,b){var c=new u(null,this,a,b);this.events.plug(c.events);
this.value.onValue(c.receiver);this.event["outlet/connect"].emit(c);return c};m.prototype.disconnect=function(a){this.event["outlet/disconnect"].emit(a);this.value.offValue(a.receiver);this.events.unplug(a.events)};m.prototype.send=function(a){this.value.emit(this.adapt?this.adapt(a):a)};m.prototype.stream=function(a){this.value.plug(this.adapt?a.map(this.adapt):a)};u.prototype.pass=function(a){this.event["link/pass"].emit(a)};u.prototype.adapt=function(a){if(this.adapter){var b=this.adapter(a);this.event["link/adapt"].emit([a,
b]);return b}this.event["link/adapt"].emit([a,a]);return a};u.prototype.enable=function(){this.event["link/enable"].emit()};u.prototype.disable=function(){this.event["link/disable"].emit()};u.prototype.disconnect=function(){this.outlet.disconnect(this)};return{Model:d,Node:t,Inlet:b,Outlet:m,Link:u,nodetype:function(a,b){x[a]=b},linktype:function(a,b){e[a]=b},channeltype:function(a,b){h[a]=b},nodedescription:function(a,b){f[a]=b},renderer:function(a,b){c[a]=b},subrenderer:function(a,b){k[a]||(k[a]=
[]);k[a].push(b)},noderenderer:function(a,b,c){if(!x[a])throw Error("Node type "+a+" is not registered");x[a].render||(x[a].render={});x[a].render[b]=c},channelrenderer:function(a,b,c){if(!h[a])throw Error("Channel type "+a+" is not registered");h[a].render||(h[a].render={});h[a].render[b]=c},allNodeTypes:x,allDescriptions:f,currentModel:function(){return p[z]}}}();(function(){function d(e){function h(a){a.preventDefault();a.stopPropagation()}function d(a){return{x:a.clientX,y:a.clientY}}function c(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top}}function k(a){return function(b){return{pos:b,target:a}}}function z(a){return!a}function p(a,b,c,e){Kefir.fromEvent(a,"click").tap(h).mapTo(e||!1).scan(z).onValue(function(a){a?b():c()})}function a(a,c,A,e,l){l=b("div","rpd-value-editor");var q=Kefir.emitter(),d=Kefir.emitter();c.disableEditor=d;a.render.html.edit(l,
a,q).onValue(function(b){a.receive(b)});Kefir.sampledBy([a.event["inlet/update"]],[Kefir.merge([Kefir.fromEvent(e,"click").tap(h).mapTo(!0),Kefir.fromEvent(A,"click").merge(d).mapTo(!1)]).toProperty(!1).skipDuplicates()]).map(function(a){return{lastValue:a[0],startEditing:a[1],cancelEditing:!a[1]}}).onValue(function(a){a.startEditing?(c.link&&c.link.disable(),q.emit(a.lastValue),e.classList.add("rpd-editor-enabled")):a.cancelEditing&&e.classList.remove("rpd-editor-enabled")});e.classList.add("rpd-editor-disabled");
e.appendChild(l)}function x(a,b){if(b)for(var c in b)(function(b,c){a.event["inlet/add"].filter(function(a){return a.alias===c}).onValue(function(a){b.default&&a.receive(b.default());if(b.valueOut)b.valueOut.onValue(function(b){a.receive(b)})})})(b[c],c)}function g(a,b){for(var A,e,l,d=0,h=b.length;d<h;d++)A=b[d].link,e=b[d].elm,l=F[A.inlet.id].connectorElm,A=y[A.outlet.id].connectorElm,l=c(l),A=c(A),O(e,A.x,A.y,l.x,l.y)}function K(a,b,e,B){e.classList.add("rpd-drag-handle");var l;Kefir.fromEvent(e,
"mousedown").map(d).flatMap(function(a){B.classList.add("rpd-dragging");var e=c(B),A=a.x-e.x,S=a.y-e.y;l=null;B.style.zIndex=1;return Kefir.fromEvent(b,"mousemove").tap(h).takeUntilBy(Kefir.fromEvent(b,"mouseup")).map(d).map(function(a){return{x:a.x-A,y:a.y-S}}).onEnd(function(){B.classList.remove("rpd-dragging");B.style.zIndex=0;if(l)for(var a=0,b=l.length;a<b;a++)l[a].elm.style.zIndex=2})}).onValue(function(b){B.style.left=b.x+"px";B.style.top=b.y+"px";l||(l=I(a,n,function(a){a.elm.style.zIndex=
3}));g(a,l)})}function M(a,c,e){var d={},l=[],q,v,f,R;for(q in c)f=q.split("/"),v=f[0],R=f[1],l.push([f,v,R]),d[v]||(d[v]={}),d[v][R]=c[q];var g=b("dl","rpd-nodelist"),r,k,n;for(v in d){r=m("dd","rpd-toolkit-name",v);g.appendChild(r);c=b("dt");l=b("dl","rpd-toolkit");q=d[v];for(R in q)q=v+"/"+R,k=m("dd","rpd-node-title",R),n=m("span","rpd-add-node","+ Add"),k.appendChild(n),f=m("dd","rpd-node-description",e[q]||"[No Description]"),l.appendChild(k),l.appendChild(f),f.classList.add("rpd-collapsed"),
function(a){p(k,function(){a.classList.add("rpd-collapsed")},function(){a.classList.remove("rpd-collapsed")})}(f),function(a){Kefir.fromEvent(n,"click").tap(h).onValue(function(){new Rpd.Node(a)})}(q);c.appendChild(l);g.appendChild(c);(function(a){p(r,function(){a.classList.add("rpd-collapsed")},function(){a.classList.remove("rpd-collapsed")},!0)})(l)}a.appendChild(g);var w=b("span","rpd-collapse-nodelist");w.innerText=w.textContent=">>";p(w,function(){w.classList.add("rpd-collapsed");w.innerText=
w.textContent="<<";g.classList.add("rpd-collapsed")},function(){w.classList.remove("rpd-collapsed");w.innerText=w.textContent=">>";g.classList.remove("rpd-collapsed")},!0);a.appendChild(w)}var N,y,F,n,r=t(e,H),J=function(){var a,b,e,B,l,q,v,g=function(a){return function(){return F[a.id].link}};return{init:function(c){v=c;a=Kefir.fromEvent(c,"click");b=Kefir.pool();e=Kefir.pool();B=Kefir.emitter();l=Kefir.emitter();q=Kefir.merge([B.mapTo(!0),l.mapTo(!1)]).toProperty(!1)},subscribeOutlet:function(g,
m){e.plug(Kefir.fromEvent(m,"click").map(d).map(k(g)));Kefir.fromEvent(m,"click").tap(h).filterBy(e.awaiting(q)).map(d).onValue(function(h){B.emit();var q=c(m),k=G(q.x,q.y,h.x,h.y,r.linkWidth);v.appendChild(k);return Kefir.fromEvent(v,"mousemove").takeUntilBy(Kefir.merge([b,e.mapTo(!1),a.mapTo(!1)]).take(1).onValue(function(a){if(a){a=a.target;var b=F[a.id].link;b&&b.outlet.disconnect(b);g.connect(a)}})).map(d).onValue(function(a){O(k,q.x,q.y,a.x,a.y)}).onEnd(function(){v.removeChild(k);l.emit()})})},
subscribeInlet:function(m,n){b.plug(Kefir.fromEvent(n,"click").map(d).map(k(m)));Kefir.fromEvent(n,"click").tap(h).filterBy(b.awaiting(q)).filter(g(m)).onValue(function(h){var q=F[m.id].link,g=q.outlet;g.disconnect(q);B.emit();var k=c(y[g.id].connectorElm),n=G(k.x,k.y,h.x,h.y,r.linkWidth);v.appendChild(n);return Kefir.fromEvent(v,"mousemove").takeUntilBy(Kefir.merge([b,e.mapTo(!1),a.mapTo(!1)]).take(1).onValue(function(a){if(a){a=a.target;var b=F[a.id].link;b&&b.outlet.disconnect(b);g.connect(a)}})).map(d).onValue(function(a){O(n,
k.x,k.y,a.x,a.y)}).onEnd(function(){v.removeChild(n);l.emit()})})}}}(),Q=Rpd.allDescriptions;return{"model/new":function(a,b){N={};y={};F={};n={};a.classList.add("rpd-model");r.layout&&a.classList.add("rpd-layout-"+r.layout);r.valuesOnHover?a.classList.add("rpd-values-on-hover"):a.classList.add("rpd-values-always-shown");r.showBoxes&&a.classList.add("rpd-show-boxes");a.style.height=document.documentElement.clientHeight+"px";Kefir.fromEvent(a,"resize").onValue(function(){a.style.height=document.documentElement.clientHeight+
"px"});J.init(a);r.renderNodeList&&M(a,Rpd.allNodeTypes,Q);Kefir.fromEvent(a,"selectstart").onValue(function(a){a.preventDefault()})},"node/add":function(a,c){var e=c.node,d=b("div","rpd-node-box"),l=b("table","rpd-node"),q,f,g,k,n;if("quartz"==r.layout){q=b("thead","rpd-title");f=b("tr");var p=b("tr","rpd-remove-button");n=b("th");n.innerText=n.textContent="x";p.appendChild(n);q.appendChild(p);p=b("th");p.setAttribute("colspan",3);p.appendChild(m("span","rpd-name",e.name));r.showTypes&&p.appendChild(m("span",
"rpd-type",e.type));f.appendChild(p);q.appendChild(f);var t=b("tbody","rpd-content"),z=b("tr"),w=b("td","rpd-inlets");k=b("table");var u=b("tbody");f=u;k.appendChild(u);w.appendChild(k);k=b("div");u=b("td","rpd-body");g=b("table");var C=b("tr"),D=b("td");D.appendChild(k);C.appendChild(D);g.appendChild(C);u.appendChild(g);var C=b("td","rpd-outlets"),D=b("table"),y=b("tbody");g=y;D.appendChild(y);C.appendChild(D);z.appendChild(w);z.appendChild(u);z.appendChild(C);t.appendChild(z);l.appendChild(q);l.appendChild(t)}else"pd"==
r.layout&&(n=b("tr","rpd-inlets"),w=b("td"),k=b("table"),f=u=b("tbody"),k.appendChild(u),w.appendChild(k),n.appendChild(w),l.appendChild(n),p=b("tr","rpd-remove-button"),n=b("td"),n.innerText=n.textContent="x",p.appendChild(n),l.appendChild(p),z=b("tr","rpd-content"),p=b("td","rpd-title"),p.appendChild(m("span","rpd-name",e.name)),r.showTypes&&p.appendChild(m("span","rpd-type",e.type)),z.appendChild(p),u=b("td","rpd-body"),k=b("div"),g=b("table"),C=b("tr"),D=b("td"),D.appendChild(k),C.appendChild(D),
g.appendChild(C),u.appendChild(g),z.appendChild(u),l.appendChild(z),q=b("tr","rpd-outlets"),C=b("td"),D=b("table"),g=y=b("tbody"),D.appendChild(y),C.appendChild(D),q.appendChild(C),l.appendChild(q),q=p);l.classList.add("rpd-"+e.type.replace("/","-"));d.style.zIndex=0;Q[e.type]&&(p.title=Q[e.type]);L(e,d,l,r.boxSize,[a.offsetWidth,a.offsetHeight]);d.appendChild(l);a.appendChild(d);N[e.id]={box:d,elm:l,body:k,inletsTrg:f,outletsTrg:g};e.render.html&&e.render.html.first&&x(e,e.render.html.first(k));
r.nodesMovingAllowed&&K(e,a,q,d);Kefir.fromEvent(n,"click").tap(h).onValue(function(){Rpd.currentModel().removeNode(e)})},"node/process":function(a,b){var e=b.node;e.render.html&&e.render.html.always&&e.render.html.always(N[e.id].body,b.inlets,b.outlets)},"node/remove":function(a,b){for(var e=b.node,c=N[e.id],d=I(e,n),h,f=0,g=d.length;f<g;f++)h=d[f],h.link.outlet.disconnect(h.link);a.removeChild(c.box);N[e.id]=null},"inlet/add":function(e,c){var d=c.inlet;if(!d.hidden){var h=N[d.node.id].inletsTrg,
l,f,g;"quartz"==r.layout?(l=b("tr","rpd-inlet rpd-stale"),g=b("td","rpd-connector"),valueHolder=b("td","rpd-value-holder"),f=b("span","rpd-value"),valueHolder.appendChild(f),l.appendChild(g),l.appendChild(valueHolder),l.appendChild(m("td","rpd-name",d.name)),r.showTypes&&l.appendChild(m("td","rpd-type",d.type))):"pd"==r.layout&&(l=b("td","rpd-inlet rpd-stale"),g=b("span","rpd-connector"),valueHolder=b("span","rpd-value-holder"),f=b("span","rpd-value"),valueHolder.appendChild(f),l.appendChild(g),l.appendChild(m("span",
"rpd-name",d.name)),l.appendChild(valueHolder),r.showTypes&&l.appendChild(m("span","rpd-type",d.type)));l.classList.add("rpd-"+d.type.replace("/","-"));h.appendChild(l);var k={elm:l,valueElm:f,connectorElm:g,disableEditor:null,link:null};F[d.id]=k;d.readonly&&l.classList.add("rpd-readonly");d.cold&&l.classList.add("rpd-cold");!d.readonly&&d.render.html&&d.render.html.edit&&a(d,k,e,valueHolder,f);d.event["inlet/update"].onError(function(){u(k,l,r.effectTime)});J.subscribeInlet(d,g)}},"inlet/update":function(a,
b){var e=b.inlet;if(!e.hidden){var c=F[e.id],d=c.elm,h=c.valueElm,f=e.def.show?e.def.show(b.value):b.value;h.innerText=h.textContent=f;e.render.html&&e.render.html.show?e.render.html.show(h,b.value,f):h.innerText=h.textContent=f;P(c,d,r.effectTime)}},"outlet/add":function(a,e){var c=e.outlet,d=N[c.node.id].outletsTrg,h,f,g;"quartz"==r.layout?(h=b("tr","rpd-outlet rpd-stale"),g=b("td","rpd-connector"),f=b("td","rpd-value"),r.showTypes&&h.appendChild(m("td","rpd-type",c.type)),h.appendChild(m("td",
"rpd-name",c.name)),h.appendChild(f),h.appendChild(g)):"pd"==r.layout&&(h=b("td","rpd-outlet rpd-stale"),g=b("span","rpd-connector"),f=b("span","rpd-value"),h.appendChild(g),h.appendChild(m("span","rpd-name",c.name)),h.appendChild(f),r.showTypes&&h.appendChild(m("span","rpd-type",c.type)));h.classList.add("rpd-"+c.type.replace("/","-"));d.appendChild(h);y[c.id]={elm:h,valueElm:f,connectorElm:g,links:{}};J.subscribeOutlet(c,g)},"outlet/update":function(a,b){var e=b.outlet,c=y[e.id],d=c.elm,h=c.valueElm;
h.innerText=h.textContent=b.value;e.render.html&&e.render.html.show?e.render.html.show(h,b.value):h.innerText=h.textContent=e.def.show?e.def.show(b.value):b.value;P(c,d,r.effectTime)},"outlet/connect":function(a,b){var e=b.link,c=e.outlet,d=y[c.id],h=F[e.inlet.id],f=d.connectorElm,g=h.connectorElm;d.links[c.id]=e;if(h.link)throw Error("Inlet is already connected to a link");h.link=e;h.disableEditor&&h.disableEditor.emit();c=f.getBoundingClientRect();g=g.getBoundingClientRect();g=G(c.left,c.top,g.left,
g.top,r.linkWidth);n[e.id]={elm:g,link:e};p(g,function(){e.enable()},function(){e.disable()});a.appendChild(g)},"outlet/disconnect":function(a,b){var e=b.link,c=n[e.id].elm,d=F[e.inlet.id];y[e.outlet.id].links[e.id]=null;d.link=null;n[e.id]=null;a.removeChild(c)},"link/enable":function(a,b){n[b.link.id].elm.classList.remove("rpd-disabled")},"link/disable":function(a,b){n[b.link.id].elm.classList.add("rpd-disabled")}}}function t(b,d){if(b){var f={},c;for(c in d)f[c]=d[c];for(c in b)f[c]=b[c];return f}return d}
function b(b,d){var f=document.createElement(b);d&&(f.className=d);return f}function m(b,d,f){b=document.createElement(b);d&&(b.className=d);b.innerText=b.textContent=f;return b}function u(b,d,f){d.classList.add("rpd-error");b.errRemoveTimeout&&clearTimeout(b.errRemoveTimeout);b.errRemoveTimeout=setTimeout(function(){d.classList.remove("rpd-error");b.errRemoveTimeout=null},f||1)}function P(b,d,f){d.classList.remove("rpd-stale");d.classList.add("rpd-fresh");b.updRemoveTimeout&&clearTimeout(b.updRemoveTimeout);
b.updRemoveTimeout=setTimeout(function(){d.classList.remove("rpd-fresh");d.classList.add("rpd-stale");b.updRemoveTimeout=null},f||1)}function G(e,d,f,c,k){var m=Math.sqrt((e-f)*(e-f)+(d-c)*(d-c));f=Math.atan2(c-d,f-e);c=b("span","rpd-link");c.style.position="absolute";c.style.zIndex=2;c.style.width=Math.floor(m)+"px";c.style.left=e+"px";c.style.top=d+"px";c.style.transformOrigin="left top";c.style.webkitTransformOrigin="left top";c.style.transform="rotateZ("+f+"rad)";c.style.webkitTransform="rotateZ("+
f+"rad)";k&&(c.style.height=k+"px");return c}function O(b,d,f,c,k){var m=Math.sqrt((d-c)*(d-c)+(f-k)*(f-k));c=Math.atan2(k-f,c-d);b.style.left=d+"px";b.style.top=f+"px";b.style.width=Math.floor(m)+"px";b.style.transform="rotateZ("+c+"rad)";b.style.webkitTransform="rotateZ("+c+"rad)"}function I(b,d,f){var c=[],k,m,p;for(p in d)d[p]&&(k=d[p],m=k.link,m.inlet.node.id===b.id||m.outlet.node.id===b.id)&&(c.push(k),f&&f(k,m));return c}function L(b,d,f,c,k){var m=(b.def.width||K)*c[0],p=x.length?x[x.length-
1]:null;b=[p?p[0]:0,p?p[1]+p[3]+Q*c[1]:0,m,(b.def.height||J)*c[1]];b[1]+c[1]>k[1]&&(b[0]=b[0]+m+M*c[0],b[1]=0);x.push(b);d.style.left=Math.floor(b[0])+"px";d.style.top=Math.floor(b[1])+"px";f.style.minWidth=Math.floor(b[2])+"px";f.style.minHeight=Math.floor(b[3])+"px";x.push(b)}var H={layout:"quartz",valuesOnHover:!1,showTypes:!1,showBoxes:!1,nodesMovingAllowed:!0,renderNodeList:!0,nodeListCollapsed:!0,boxSize:[100,40],linkWidth:null,effectTime:1E3},K=1,J=1,M=.5,Q=1,x=[];Rpd.HtmlRenderer=d;Rpd.renderer("html",
function(b){var h=d(b);return function(b,c){if(h[c.type])h[c.type](b,c)}})})();Rpd.nodedescription("core/empty","Does not allow adding any inlets or outlets.");Rpd.nodetype("core/empty",{name:"Empty",handle:{"inlet/add":function(){throw Error("Empty node can not have any inlets");},"outlet/add":function(){throw Error("Empty node can not have any outlets");}}});Rpd.nodedescription("core/custom","May have any number of inlets and outlets, a target for extension.");Rpd.nodetype("core/custom",{name:"Custom"});
Rpd.nodetype("core/sum-of-three",{name:"Sum of Three",width:1.8,inlets:{a:{type:"core/number",name:"A"},b:{type:"core/number",name:"B"},c:{type:"core/number",name:"C"}},outlets:{sum:{type:"core/number",name:"\u2211"}},process:function(d){return{sum:(d.a||0)+(d.b||0)+(d.c||0)}}});
Rpd.nodetype("core/sum-of-three-with-body",{name:"Sum of Three w/Body",width:1.8,inlets:{a:{type:"core/number",name:"A",default:1},b:{type:"core/number",name:"B"},c:{type:"core/number",name:"C",hidden:!0}},outlets:{sum:{type:"core/number",name:"\u2211"}},process:function(d){return{sum:(d.a||0)+(d.b||0)+(d.c||0)}}});Rpd.nodedescription("core/hot-and-cold","An example of cold inlet.");
Rpd.nodetype("core/hot-and-cold",{name:"Hot and Cold",inlets:{hot:{type:"core/number",name:"A",default:1},cold:{type:"core/number",name:"B",default:1,cold:!0}},outlets:{value:{type:"core/any"}},process:function(d){return{value:[d.hot,d.cold]}}});Rpd.channeltype("core/any",{});Rpd.channeltype("core/boolean",{default:!1,adapt:function(d){return d?!0:!1}});Rpd.channeltype("core/number",{default:0,readonly:!1,accept:function(d){d=parseFloat(d);return!isNaN(d)&&isFinite(d)},adapt:function(d){return parseFloat(d)}});
Rpd.linktype("core/pass",{});Rpd.noderenderer("core/sum-of-three","html",{always:function(d,t,b){d.innerHTML="\u2211 ("+(t.a||"?")+", "+(t.b||"?")+", "+(t.c||"?")+") = "+(b.sum||"?")}});
Rpd.noderenderer("core/sum-of-three-with-body","html",function(){var d;return{first:function(t){var b=document.createElement("input");b.style.display="block";b.type="number";b.min=0;b.max=10;t.appendChild(b);d=document.createElement("span");t.appendChild(d);return{c:{default:function(){return b.value=0},valueOut:Kefir.fromEvent(b,"change").map(function(){return b.value})}}},always:function(t,b,m){d.innerHTML=d.textContent="\u2211 ("+(b.a||"0")+", "+(b.b||"0")+", "+(b.c||"0")+") = "+(m.sum||"?")}}});
Rpd.channelrenderer("core/number","html",{edit:function(d,t,b){var m=document.createElement("input");m.type="number";b.onValue(function(b){m.value=b});d.appendChild(m);return Kefir.fromEvent(m,"change").map(function(){return m.value})}});
